<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Message - Messages from 061</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
<header>
  <div class="title-container">
    <h1>Messages from 061</h1>
  </div>
  <nav>
    <a href="index.html" id="home-button">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
      </svg>
    </a>
  </nav>
</header>
<main>
<section class="message markdown-body">
  <h1 id="message-title"></h1>
  <div id="message-content" class="markdown-body"></div>
  <div id="message-pagination" style="text-align:center; margin:24px 0;"></div>
</section>
  <div class="share-container" style="text-align:center; margin-bottom:24px;">
    <button id="share-btn">Share!</button>
  </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
(function() {
  const messages = [
    "eyes-wide-shut.md",
    "i-want-to-be-somebody-to-you.md",
    "not-guilty.md",
    "russian-roulette.md",
    "she-cant-run.md",
    "the-last-bite.md"
  ];
  const params = new URLSearchParams(window.location.search);
  const file = params.get("file");
  if (!file) return;
  const contentContainer = document.getElementById("message-content");
  const titleContainer = document.getElementById("message-title");
  const markdownPath = 'messages/' + file;
  fetch(markdownPath)
    .then(res => res.text())
    .then(md => {
      const lines = md.split('\n');
      let titleLineIndex = lines.findIndex(l => l.trim().startsWith('# '));
      let titleText = '';
      if (titleLineIndex >= 0) {
        titleText = lines[titleLineIndex].replace(/^#\s*/, '');
        lines.splice(titleLineIndex, 1);
      } else {
        titleText = file.replace('.md', '');
      }
      titleContainer.textContent = titleText;
      contentContainer.innerHTML = marked.parse(lines.join('\n'));
      const index = messages.indexOf(file);
      const container = document.getElementById("message-pagination");
      if (container) {
        container.innerHTML =
          (index > 0 ? `<a href="message.html?file=${messages[index - 1]}">← Previous</a>` : `<span style="opacity:0.5;">← Previous</span>`) +
          `<span style="margin:0 12px;">|</span>` +
          (index < messages.length - 1 ? `<a href="message.html?file=${messages[index + 1]}">Next →</a>` : `<span style="opacity:0.5;">Next →</span>`);
      }
    })
    .catch(err => {
      contentContainer.innerHTML = '<p>Could not load message.</p>';
      console.error(err);
    });
  const shareBtn = document.getElementById("share-btn");
  if (shareBtn) {
    shareBtn.addEventListener("click", async () => {
      if (navigator.share) {
        try {
          await navigator.share({
            title: document.getElementById("message-title")?.textContent || "Message",
            text: "Check out this message from Messages from 061.",
            url: window.location.href
          });
        } catch {}
      } else {
        alert("Copy this URL:\n" + window.location.href);
      }
    });
  }
  document.addEventListener("keydown", e => {
    const index = messages.indexOf(file);
    if (index < 0) return;
    if (e.key === "ArrowLeft" && index > 0) {
      window.location.href = `message.html?file=${messages[index - 1]}`;
    }
    if (e.key === "ArrowRight" && index < messages.length - 1) {
      window.location.href = `message.html?file=${messages[index + 1]}`;
    }
  });
})();
</script>
</body>
</html>
